- name: Create proftpd dir
  file: path="{{ galaxy_ftp }}" state=directory mode=0777
  sudo: yes
  sudo_user: "{{ galaxy_user_name }}"

- name: Manage templates for galaxy and proftpd
  template: src={{ item.src }} dest={{ item.dest }} backup=no
  with_items:
    - { src: "welcome.html", dest: "{{ galaxy_server_dir }}/static/" }
    - { src: "tool_sheds_conf.xml", dest: "{{ galaxy_config_dir }}" }
    - { src: "proftpd.conf.j2", dest: "{{ proftpd_conf_path }}" }
    - { src: "shed_tool_conf.xml", dest: "{{ galaxy_config_dir }}" }

- name:  Provide Galaxy images for the homepage
  copy: src={{ item.src }} dest={{ item.dest }} owner=galaxy
  with_items:
    - { src: "ARTiMED_logo.png", dest: "{{ galaxy_server_dir }}/static/images/" }
    - { src: "logo_iuis_UPMC_UTC.jpg", dest: "{{ galaxy_server_dir }}/static/images/" }
    
- name: Restart/start supervisor tasks
  supervisorctl: name={{ item.name }} state={{ item.state }}
  with_items:
    - { name: "proftpd", state: "restarted" }
    - { name: "munge", state: "started" }
    - { name: "nginx", state: "started" }
    - { name: "posgresql", state: "started" }
    - { name: "slurm", state: "started" }
    - { name: "slurmctld", state: "started" }