user  galaxy;
worker_processes  1;
daemon off;

events {
    worker_connections  1024;
}

http {
    #include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;

    keepalive_timeout  65;
    types_hash_max_size 2048;

    gzip  on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;

    client_max_body_size 50g;

    upstream galaxy_app {
        server localhost:8080;
    }
    # if using more than one upstream, disable nginx's round-robin
    # scheme to prevent it from submitting POST requests more than
    # once (this is unsafe)
    proxy_next_upstream off;
    server {
        client_max_body_size 10G;
        # ... other server stuff ...
        location / {
            proxy_pass   http://galaxy_app;
            proxy_set_header   X-Forwarded-Host $host;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            satisfy any;
            #include /etc/nginx/conf.d/allow_jussieu_ip.conf;
            auth_basic "Restricted";
            auth_basic_user_file /etc/nginx/.htpasswd;
            deny all;
        }
        # serve static content for visualization plugins
        location ~ ^/plugins/visualizations/(?<vis_name>.+?)/static/(?<static_file>.*?)$ {
            alias /home/galaxy/galaxy/config/plugins/visualizations/$vis_name/static/$static_file;
        }
    }
}